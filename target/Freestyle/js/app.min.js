!function(t){t.fn.drag=function(e,a,o){var r="string"==typeof e?e:"",i=t.isFunction(e)?e:t.isFunction(a)?a:null;return 0!==r.indexOf("drag")&&(r="drag"+r),o=(e==i?a:o)||{},i?this.bind(r,o,i):this.trigger(r)};var e=t.event,a=e.special,o=a.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(e){var a=t.data(this,o.datakey),r=e.data||{};a.related+=1,t.each(o.defaults,function(t,e){void 0!==r[t]&&(a[t]=r[t])})},remove:function(){t.data(this,o.datakey).related-=1},setup:function(){if(!t.data(this,o.datakey)){var a=t.extend({related:0},o.defaults);t.data(this,o.datakey,a),e.add(this,"touchstart mousedown",o.init,a),this.attachEvent&&this.attachEvent("ondragstart",o.dontstart)}},teardown:function(){(t.data(this,o.datakey)||{}).related||(t.removeData(this,o.datakey),e.remove(this,"touchstart mousedown",o.init),o.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",o.dontstart))},init:function(r){if(!o.touched){var i,s=r.data;if(!(0!=r.which&&s.which>0&&r.which!=s.which)&&!t(r.target).is(s.not)&&(!s.handle||t(r.target).closest(s.handle,r.currentTarget).length)&&(o.touched="touchstart"==r.type?this:null,s.propagates=1,s.mousedown=this,s.interactions=[o.interaction(this,s)],s.target=r.target,s.pageX=r.pageX,s.pageY=r.pageY,s.dragging=null,i=o.hijack(r,"draginit",s),s.propagates))return i=o.flatten(i),i&&i.length&&(s.interactions=[],t.each(i,function(){s.interactions.push(o.interaction(this,s))})),s.propagates=s.interactions.length,!1!==s.drop&&a.drop&&a.drop.handler(r,s),o.textselect(!1),o.touched?e.add(o.touched,"touchmove touchend",o.handler,s):e.add(document,"mousemove mouseup",o.handler,s),!(!o.touched||s.live)&&void 0}},interaction:function(e,a){var r=t(e)[a.relative?"position":"offset"]()||{top:0,left:0};return{drag:e,callback:new o.callback,droppable:[],offset:r}},handler:function(r){var i=r.data;switch(r.type){case!i.dragging&&"touchmove":r.preventDefault();case!i.dragging&&"mousemove":if(Math.pow(r.pageX-i.pageX,2)+Math.pow(r.pageY-i.pageY,2)<Math.pow(i.distance,2))break;r.target=i.target,o.hijack(r,"dragstart",i),i.propagates&&(i.dragging=!0);case"touchmove":r.preventDefault();case"mousemove":if(i.dragging){if(o.hijack(r,"drag",i),i.propagates){!1!==i.drop&&a.drop&&a.drop.handler(r,i);break}r.type="mouseup"}case"touchend":case"mouseup":default:o.touched?e.remove(o.touched,"touchmove touchend",o.handler):e.remove(document,"mousemove mouseup",o.handler),i.dragging&&(!1!==i.drop&&a.drop&&a.drop.handler(r,i),o.hijack(r,"dragend",i)),o.textselect(!0),!1===i.click&&i.dragging&&t.data(i.mousedown,"suppress.click",(new Date).getTime()+5),i.dragging=o.touched=!1}},hijack:function(a,r,i,s,h){if(i){var n,l,d,c={event:a.originalEvent,type:a.type},p=r.indexOf("drop")?"drag":"drop",g=s||0,f=isNaN(s)?i.interactions.length:s;a.type=r,a.originalEvent=null,i.results=[];do{if(l=i.interactions[g]){if("dragend"!==r&&l.cancelled)continue;d=o.properties(a,i,l),l.results=[],t(h||l[p]||i.droppable).each(function(s,h){if(d.target=h,a.isPropagationStopped=function(){return!1},n=h?e.dispatch.call(h,a,d):null,!1===n?("drag"==p&&(l.cancelled=!0,i.propagates-=1),"drop"==r&&(l[p][s]=null)):"dropinit"==r&&l.droppable.push(o.element(n)||h),"dragstart"==r&&(l.proxy=t(o.element(n)||l.drag)[0]),l.results.push(n),delete a.result,"dropinit"!==r)return n}),i.results[g]=o.flatten(l.results),"dropinit"==r&&(l.droppable=o.flatten(l.droppable)),"dragstart"!=r||l.cancelled||d.update()}}while(++g<f);return a.type=c.type,a.originalEvent=c.event,o.flatten(i.results)}},properties:function(t,e,a){var r=a.callback;return r.drag=a.drag,r.proxy=a.proxy||a.drag,r.startX=e.pageX,r.startY=e.pageY,r.deltaX=t.pageX-e.pageX,r.deltaY=t.pageY-e.pageY,r.originalX=a.offset.left,r.originalY=a.offset.top,r.offsetX=r.originalX+r.deltaX,r.offsetY=r.originalY+r.deltaY,r.drop=o.flatten((a.drop||[]).slice()),r.available=o.flatten((a.droppable||[]).slice()),r},element:function(t){if(t&&(t.jquery||1==t.nodeType))return t},flatten:function(e){return t.map(e,function(e){return e&&e.jquery?t.makeArray(e):e&&e.length?o.flatten(e):e})},textselect:function(e){t(document)[e?"unbind":"bind"]("selectstart",o.dontstart).css("MozUserSelect",e?"":"none"),document.unselectable=e?"off":"on"},dontstart:function(){return!1},callback:function(){}};o.callback.prototype={update:function(){a.drop&&this.available.length&&t.each(this.available,function(t){a.drop.locate(this,t)})}};var r=e.dispatch;e.dispatch=function(e){return t.data(this,"suppress."+e.type)-(new Date).getTime()>0?void t.removeData(this,"suppress."+e.type):r.apply(this,arguments)};var i=e.fixHooks.touchstart=e.fixHooks.touchmove=e.fixHooks.touchend=e.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(e,a){if(a){var o=a.touches&&a.touches[0]||a.changedTouches&&a.changedTouches[0]||null;o&&t.each(i.props,function(t,a){e[a]=o[a]})}return e}};a.draginit=a.dragstart=a.dragend=o}(jQuery);var FreestyleController=function(t,e){var a=this;a.itemClass="item",a.itemSelector="."+a.itemClass,a.items=[],a.props={},a.nodrag=!0,a.firstLoad=!0,a.preservedHeight=600,a.lastIndex=-1,this.resize=_.debounce(_.bind(this._resize,this),200),FreestyleController.super_.apply(this,arguments),$(a.el).on("click",".filler",function(t){if(1==a.nodrag){var e=$(t.currentTarget).parent().index();a.lastIndex==a.activeIndex&&a.itemClick(a.items[e],e,t)}else a.nodrag=!0}),$(a.el).on("dblclick",".filler, .caman",function(t){var e=$(t.currentTarget).parent().index();a.itemClick(a.items[e],e,t)})};utils.inherits(FreestyleController,SimpleAppProto),FreestyleController.prototype.itemClick=function(t,e,a){var o=this;switch(o.props.galleryImageOnClickAction){case"goToLink":o.openLink(t.href,t.target,t.linkType,a,t["data-anchor"],o.mainPageId,t.link);break;case"zoomMode":Wix.pushState(JSON.stringify({cmd:"zoom",args:[e]}));break;case"disabled":default:Wix.pushState(JSON.stringify({cmd:"itemClicked",args:[e]}))}},FreestyleController.prototype.createDom=function(){var t=this,e=1,a=t.getViewportSize();t.containerHeight=a.height,t.itemsInViewport=5,t.el.html(""),t.displayNode=$('<div id="container"></div>').appendTo(this.el);$("#container");_.each(this.items,function(e,a){var o=$('<div class="drag"></div>').appendTo(t.displayNode);o.data("item",e).addClass(t.itemClass),t.isMobile?o.addClass("hide"):$('<div class="rotate NE"></div><div class="handle NW"></div><div class="handle SW"></div><div class="handle SE"></div>').appendTo(o),$('<div class="border"></div>').appendTo(o),$('<div class="filler"></div>').appendTo(o),$('<svg class="overlay">').appendTo(o),$('<img class="caman">').appendTo(o).attr("id","caman-"+a).addClass("hide");var r=$('<div class="details"></div>').appendTo(o).addClass("hide");$('<h3 class="title"></h3>').appendTo(r).html(e.title)}),t.isMobile&&"vertical"==t.props.orientation&&t.itemsInViewport<t.items.length&&$('<div class="show-more">Show More</div>').appendTo(t.el).click(_.bind(t.displayMore,this)),t.isMobile||$(".drag").mousedown(function(a){t.lastIndex=t.activeIndex,$(t.itemSelector,t.el).removeClass("active"),$(".drag").css("cursor",""),$(this).css("zIndex",e++).addClass("active"),t.activeIndex=$(this).index(),"goToLink"!==t.props.galleryImageOnClickAction||_.isEmpty(t.items[t.activeIndex].href)||$(this).css("cursor","pointer")}),$(".drag").on("touchstart",function(){t.lastIndex=t.activeIndex,$(t.itemSelector,t.el).removeClass("active"),$(this).css("zIndex",e++).addClass("active"),t.activeIndex=$(this).index()}),t.displayNode.css({position:"absolute",top:"0px",bottom:"0px",left:"0px",right:"0px"})},FreestyleController.prototype.displayMore=function(){for(var t=this,e=Math.min(t.items.length,t.itemsInViewport+5),a=t.shuffleIndexes(),o=t.itemsInViewport;o<e;o++)$(t.itemSelector,t.el).eq(a.indexOf(o)).removeClass("hide");this.itemsInViewport=e,t.containerHeight=t.elementSize*(e+1),Wix.setHeight(Math.floor(t.elementSize*(e+.5))),t.itemsInViewport==t.items.length?$(".show-more").addClass("hide"):$(".show-more").css({top:Math.floor(t.elementSize*(e+.8))+"px"})},FreestyleController.prototype.shuffleIndexes=function(){var t=this;Math.seedrandom("layout-seed-"+t.props.layoutSeed);var e=[];t.random=[];for(var a=0;a<t.items.length;a++)e.push(a),t.random[a]=Math.random();for(var o,r,i=e.length;0!==i;)r=Math.floor(Math.random()*i),i-=1,o=e[i],e[i]=e[r],e[r]=o;return e},FreestyleController.prototype.updateLayout=function(){var t=this,e=!1;if("horizontal"==t.props.orientation&&$(t.itemSelector,t.el).removeClass("hide"),/MSIE (\d+\.\d+);/.test(navigator.userAgent)){new Number(RegExp.$1)<9&&(e=!0,$(".rotate").css("display","none"))}var a,o=t.getViewportSize(),r=o.width,i=0,s=0,h=1==e?"none":t.props.imageDecoration,n=t.items.length,l=Math.floor((r-180)/270)||1,d=t.props.borderWidth,c=o.width-230>270?1:Math.max((o.width-230)/270,.5),p=Math.floor(270*c),g=!1,f=!1,u=!1;t.elementSize=p,a=t.isMobile&&"vertical"==t.props.orientation?t.elementSize*(t.itemsInViewport+1):o.height,"editor"==t.editMode&&($(".item").removeClass("active"),t.activeIndex=null),t.isMobile||"vertical"!=t.props.orientation?t.isMobile||"horizontal"!=t.props.orientation||(t.preservedHeight="site"==t.editMode?t.containerHeight:t.preservedHeight,Wix.setHeight(t.preservedHeight),t.containerHeight=t.preservedHeight):"none"!=t.props.imageDecoration&&"vintageFrame"!=t.props.imageDecoration||"fit"!=t.props.cropAndFitStage?Wix.setHeight((Math.ceil(n/l)+.9)*p):Wix.setHeight((Math.ceil(n/l)+.5)*p);var M=t.shuffleIndexes();if("random"==t.props.imageDecoration&&1!=e)for(var m=["none","polaroid","scotchTape","vintageFrame"],v=[],w=0;w<n;w++)v.push(m[Math.floor(4*t.random[w])]);$(t.el).hammer(),$(t.itemSelector,t.el).each(function(n){var m,w,x,y,I=$(this),b=I.data("item"),P=0,k=0,C=0,S=b.width/b.height,F=0,W=0,z=0,X=0,Y=M[n],A=1==t.props.applyRotationInLayout?330+Math.floor(60*t.random[M[Y]]):0,T=1,H={};switch(t.changeCursor(I,A),Y<t.itemsInViewport&&I.removeClass("hide"),"random"==t.props.imageDecoration&&1!=e&&(h=v[n]),I.on("rotate",function(e){n==t.activeIndex&&(g=!0,u=!0,X=Math.floor(e.gesture.rotation),t.rotate(I,A+X))}).on("pinch",function(e){if(n==t.activeIndex){f=!0;for(var a=e.gesture.target,o=0;o<e.gesture.touches.length;o++)e.gesture.touches[o].target!=a&&(f=!1);if(1==f){u=!0,T=e.gesture.scale;var r=I.height()*(1-T),i=I.width()*(1-T);H.width=Math.floor(Math.max(75,I.width()*T)),H.height=Math.floor(Math.max(75*I.height()/I.width(),I.height()*T)),H.left=y+Math.floor(i/2),H.top=x+Math.floor(r/2),$(this).css(H);var s="random"==t.props.imageDecoration?v[n]:t.props.imageDecoration;t.applyResizing(I,H,s)}}}).on("release",function(e){if(0!=X&&g&&(g=!1,A+=X),X=0,f){var a=H.width,o=H.height;f=!1;var r="random"==t.props.imageDecoration?v[n]:t.props.imageDecoration;t.finalizeResizing(I,n,a,o,r)}u=!1,x=I[0].offsetTop,y=I[0].offsetLeft}),h){case"none":"crop"==t.props.cropAndFitStage?(P=p,k=p):b.width>b.height?(P=p,k=Math.floor(p/S)):(P=Math.floor(p*S),k=p),I.width(P+2*d).height(k+2*d),$(".filler",I).css({backgroundSize:"cover",border:t.props.borderWidth+"px solid "+utils.hexToRgba(t.props.borderColor,t.props.alphaBorderColor)}),$(".overlay",I).attr("class","overlay hide");break;case"polaroid":I.width(p).height(Math.floor(31*p/27)),I.css("background-color","#F9F9F9"),$(".border",I).removeClass("sloppy").css({backgroundColor:utils.hexToRgba(t.props.borderColor||"#000000",t.props.alphaBorderColor||.5),backgroundSize:"cover",top:Math.floor(20*c)+"px",left:Math.floor(20*c)+"px",right:Math.floor(20*c)+"px",bottom:Math.floor(60*c)+"px"}),$(".filler",I).css({backgroundSize:"cover",top:Math.floor(20*c)+d+"px",left:Math.floor(20*c)+d+"px",right:Math.floor(20*c)+d+"px",bottom:Math.floor(60*c)+d+"px"}),I.addClass("dropShadow"),$(".overlay",I).attr("class","overlay hide"),P=p-40-2*t.props.borderWidth,k=p-40-2*t.props.borderWidth;break;case"scotchTape":P=p,k=p,I.width(P+2*d).height(k+2*d),$(".filler",I).css({backgroundSize:"cover",border:t.props.borderWidth+"px solid "+utils.hexToRgba(t.props.borderColor,t.props.alphaBorderColor)});var E=Math.abs(A)%3+1;$(".overlay",I).attr("class","overlay ductTape"+E).width(p+2*d).height(p+2*d);break;case"vintageFrame":var L,D;"crop"==t.props.cropAndFitStage?(P=p,k=p):b.width>b.height?(P=p,k=Math.floor(p/S)):(P=Math.floor(p*S),k=p),L=Math.floor(1.07*P),D=Math.floor(1.08*k),I.width(L+2*d).height(D+2*d),$(".overlay",I).attr("class","overlay hide"),$(".border",I).addClass("sloppy").css({width:L+"px",height:D+"px",border:t.props.borderWidth+"px solid "+utils.hexToRgba(t.props.borderColor,t.props.alphaBorderColor)}),$(".filler",I).css({backgroundSize:"cover",top:d+Math.floor(.036*k)+"px",left:d+Math.floor(.029*P)+"px",right:d+Math.floor(.034*P)+"px",bottom:d+Math.floor(.04*k)+"px"});break;case"vintageFilter":"crop"==t.props.cropAndFitStage?(P=p,k=p):b.width>b.height?(P=p,k=Math.floor(p/S)):(P=Math.floor(p*S),k=p),I.width(P).height(k),$(".caman",I).width(P).height(k),$(".overlay",I).attr("class","overlay hide")}var N=utils.getResizedImageUrl(b.uri,P,k,{siteQuality:t.quality,maxWidth:b.width,maxHeight:b.height});if("vintageFilter"==h){var V,_={store:!1};N="http://127.0.0.1/wix/index.php?imgUri="+N}if("horizontal"==t.props.orientation)I.css({position:"absolute",top:Math.floor(t.random[n]*(a-1.4*I.height())+.2*I.height())+"px",left:Math.floor(t.random[M[n]]*(r-1.3*I.width())+.15*I.width())+"px"});else{var R,j,q=Math.floor(Y/l),O=(Math.floor(.1*I.width()),Math.floor(.1*I.height()));j=Math.floor(q*p+.3*I.height()+2*t.random[n]*O),R=Math.floor(Y%l*((r-100)/l)+(r-100-l*I.width())/l*t.random[n])+50,I.css({position:"absolute",top:j+"px",left:R+"px"}),!t.isMobile&&j+1.5*I.height()>i?i=Math.floor(j+1.5*I.height()):Y<t.itemsInViewport&&j+1.5*I.height()>i&&(i=Math.floor(j+1.5*I.height()),s=Math.floor(j+1.3*I.height())),t.itemsInViewport==t.items.length?$(".show-more").addClass("hide"):$(".show-more").css({top:s+"px",left:Math.floor((o.width-150)/2)+"px"})}t.rotate(I,A),$(".filler",I).css({backgroundImage:"url("+N+")"}),"vintageFilter"==h?($(".caman",I).removeClass("hide"),$(".filler",I).addClass("hide"),$.ajax({url:N,type:"get",dataType:"text",success:function(t,e,a){$(".caman",I).attr("src","data:image/jpeg;base64,"+t),V=Filtrr2($("#caman-"+n),function(){this.brighten(20).saturate(-50).contrast(20).expose(.6).render()},_)},error:function(t){console.log(t)}})):($(".caman",I).addClass("hide"),$(".caman",I).removeAttr("data-caman"),$(".filler",I).removeClass("hide")),x=I[0].offsetTop,y=I[0].offsetLeft;var B,U,Q=0,J=0,G=!1,K={};I.drag("start",function(a){G=!0,B=a.target,K={attr:$(a.target).prop("className"),width:I.width(),height:I.height()},C=I.width()/I.height(),Q=I[0].offsetTop,J=I[0].offsetLeft,h=1!=e?"random"==t.props.imageDecoration?v[n]:t.props.imageDecoration:"none",U=K.attr,t.changeElCursor(U,A)}).drag(function(e,o){var i=0,s=0,n=0,l=0;switch(o=$.extend({},K,o||{}),o.attr){case"rotate NE":var c=Math.atan(I.height()/I.width()),p=o.deltaX*Math.cos(A*Math.PI/180)+o.deltaY*Math.sin(A*Math.PI/180),g=-o.deltaX*Math.sin(A*Math.PI/180)+o.deltaY*Math.cos(A*Math.PI/180);i=Math.floor((I.width()/2+p+15)*Math.cos(c)+(I.height()/2-g+15)*Math.sin(c)),s=Math.floor(-g*Math.cos(c)-p*Math.sin(c)),z=i>=0?Math.floor(180*Math.atan(-s/i)/Math.PI):Math.floor(180+180*Math.atan(-s/i)/Math.PI),W=!0,t.rotate(I,A+z);break;case"handle SE":m=Math.max(100,o.width+Math.floor(o.deltaX*Math.cos(A*Math.PI/180)+o.deltaY*Math.sin(A*Math.PI/180))),w="none"==h&&"fit"==t.props.cropAndFitStage?Math.floor((m-2*d)/S+2*d):Math.floor(m/C),w>o.height-o.deltaX*Math.sin(A*Math.PI/180)+o.deltaY*Math.cos(A*Math.PI/180)&&(w=Math.max(Math.ceil((100-2*d)/S+2*d),Math.floor(o.height-o.deltaX*Math.sin(A*Math.PI/180)+o.deltaY*Math.cos(A*Math.PI/180))),m="none"==h&&"fit"==t.props.cropAndFitStage?Math.floor((w-2*d)*S+2*d):Math.floor(w*C)),n=o.height-w,l=o.width-m,H.top=Math.floor(Q-.5*(l*Math.sin(A*Math.PI/180)+n*Math.cos(A*Math.PI/180)-n)),H.left=Math.floor(J-.5*(l*Math.cos(A*Math.PI/180)-n*Math.sin(A*Math.PI/180)-l)),F=!0,W=!1;break;case"handle NW":m=Math.max(100,o.width-Math.floor(o.deltaX*Math.cos(A*Math.PI/180)+o.deltaY*Math.sin(A*Math.PI/180))),w="none"==h&&"fit"==t.props.cropAndFitStage?Math.floor((m-2*d)/S+2*d):Math.floor(m/C),w>o.height+o.deltaX*Math.sin(A*Math.PI/180)-o.deltaY*Math.cos(A*Math.PI/180)&&(w=Math.max(Math.ceil((100-2*d)/S+2*d),Math.floor(o.height+o.deltaX*Math.sin(A*Math.PI/180)-o.deltaY*Math.cos(A*Math.PI/180))),m="none"==h&&"fit"==t.props.cropAndFitStage?Math.floor((w-2*d)*S+2*d):Math.floor(w*C)),n=o.height-w,l=o.width-m,H.top=Math.floor(Q+.5*(l*Math.sin(A*Math.PI/180)+n*Math.cos(A*Math.PI/180)+n)),H.left=Math.floor(J-.5*(n*Math.sin(A*Math.PI/180)-l*Math.cos(A*Math.PI/180)-l)),F=!0,W=!1;break;case"handle SW":m=Math.max(100,o.width-Math.floor(o.deltaX*Math.cos(A*Math.PI/180)+o.deltaY*Math.sin(A*Math.PI/180))),w="none"==h&&"fit"==t.props.cropAndFitStage?Math.floor((m-2*d)/S+2*d):Math.floor(m/C),w>o.height-o.deltaX*Math.sin(A*Math.PI/180)+o.deltaY*Math.cos(A*Math.PI/180)&&(w=Math.max(Math.ceil((100-2*d)/S+2*d),Math.floor(o.height-o.deltaX*Math.sin(A*Math.PI/180)+o.deltaY*Math.cos(A*Math.PI/180))),m="none"==h&&"fit"==t.props.cropAndFitStage?Math.floor((w-2*d)*S+2*d):Math.floor(w*C)),n=o.height-w,l=o.width-m,H.top=Math.floor(Q+.5*(l*Math.sin(A*Math.PI/180)-n*Math.cos(A*Math.PI/180)+n)),H.left=Math.floor(J+.5*(l*Math.cos(A*Math.PI/180)+n*Math.sin(A*Math.PI/180)+l)),F=!0,W=!1;break;case"rotate EE":i=Math.floor(I.width()/2+o.deltaX*Math.cos(A*Math.PI/180)+o.deltaY*Math.sin(A*Math.PI/180)),s=Math.floor(-o.deltaX*Math.sin(A*Math.PI/180)+o.deltaY*Math.cos(A*Math.PI/180)),z=i>=0?Math.floor(180*Math.atan(s/i)/Math.PI):Math.floor(180+180*Math.atan(s/i)/Math.PI),W=!0,t.rotate(I,A+z);break;case"rotate NN":i=Math.floor(I.height()/2+o.deltaX*Math.sin(A*Math.PI/180)-o.deltaY*Math.cos(A*Math.PI/180)),s=Math.floor(o.deltaX*Math.cos(A*Math.PI/180)+o.deltaY*Math.sin(A*Math.PI/180)),z=i>=0?Math.floor(180*Math.atan(s/i)/Math.PI):Math.floor(180+180*Math.atan(s/i)/Math.PI),W=!0,t.rotate(I,A+z);break;case"rotate WW":i=Math.floor(I.width()/2-o.deltaX*Math.cos(A*Math.PI/180)-o.deltaY*Math.sin(A*Math.PI/180)),s=Math.floor(-o.deltaX*Math.sin(A*Math.PI/180)+o.deltaY*Math.cos(A*Math.PI/180)),z=i>=0?Math.floor(180*-Math.atan(s/i)/Math.PI):Math.floor(-180-180*Math.atan(s/i)/Math.PI),W=!0,t.rotate(I,A+z);break;case"rotate SS":i=Math.floor(I.height()/2-o.deltaX*Math.sin(A*Math.PI/180)+o.deltaY*Math.cos(A*Math.PI/180)),s=Math.floor(-o.deltaX*Math.cos(A*Math.PI/180)-o.deltaY*Math.sin(A*Math.PI/180)),z=i>=0?Math.floor(180*Math.atan(s/i)/Math.PI):Math.floor(180+180*Math.atan(s/i)/Math.PI),W=!0,t.rotate(I,A+z);break;default:u||(a=t.isMobile?t.containerHeight:a,H.top=Q+o.deltaY+I.height()/2>0&&Q+o.deltaY+I.height()/2<a?Q+o.deltaY:H.top,H.left=J+o.deltaX+I.width()/2>0&&J+o.deltaX+I.width()/2<r?J+o.deltaX:H.left,H.left+I.width()/2,H.top+I.height()/2,m=I.width(),w=I.height(),F=!1,W=!1,t.nodrag=!1,x=I[0].offsetTop,y=I[0].offsetLeft)}H.width=m,H.height=w,$(this).css(H),t.applyResizing(I,H,h)}).drag("end",function(e){$(t.el).css("cursor","auto"),G=!1,t.nodrag=t.isMobile,B=null,K={},F&&t.finalizeResizing(I,n,m,w,h),W&&(A=(A+z)%360>180?(A+z-360)%360:(A+z)%360<-180?(A+z+360)%360:(A+z)%360,t.changeCursor(I,A))})}),"vertical"==t.props.orientation&&(t.containerHeight=i,t.isMobile&&(t.updated=!0,Wix.setHeight(i))),t.isMobile&&$(t.el).css({touchAction:"auto"})},FreestyleController.prototype.applyResizing=function(t,e,a){var o=this,r=e.width,i=e.height,s=o.props.borderWidth;$(".overlay",t).width(r).height(i),$(".caman",t).width(r).height(i),"vintageFrame"==a?($(".filler",t).css({top:s+Math.floor(.034*i)+"px",left:s+Math.floor(.027*r)-1+"px",right:s+Math.floor(.032*r)+"px",bottom:s+Math.floor(.038*i)+"px"}),$(".border",t).css({width:Math.floor(r-2*s)+"px",height:i-2*s+"px"})):"polaroid"==a&&($(".border",t).css({top:Math.floor(20*t.width()/270)+"px",left:Math.floor(20*t.width()/270)+"px",right:Math.floor(20*t.width()/270)+"px",bottom:Math.floor(60*t.width()/270)+"px"}),$(".filler",t).css({backgroundSize:"cover",top:Math.floor(20*t.width()/270)+s+"px",left:Math.floor(20*t.width()/270)+s+"px",right:Math.floor(20*t.width()/270)+s+"px",bottom:Math.floor(60*t.width()/270)+s+"px"}))},FreestyleController.prototype.finalizeResizing=function(t,e,a,o,r){var i,s,h,n=this,l=n.items[e],d=l.uri,c=n.props.borderWidth;switch(r){case"none":a-2*c>n.items[e].width||o-2*c>n.items[e].height?"crop"==n.props.cropAndFitStage?(s=Math.min(n.items[e].width,n.items[e].height),h=Math.min(n.items[e].width,n.items[e].height)):(s=n.items[e].width,h=n.items[e].height):(s=a-2*c,h=o-2*c);break;case"polaroid":s=a-Math.floor(a/270*80-2*c),h=a-Math.floor(a/270*80-2*c);break;case"scotchTape":a-2*c>n.items[e].width||o-2*c>n.items[e].height?(s=Math.min(n.items[e].width,n.items[e].height),s=Math.min(n.items[e].width,n.items[e].height)):(s=a-2*c,h=a-2*c);break;case"vintageFrame":s=a-2*c,h=o-2*c,$(".border",t).css({width:Math.floor(a-2*c)+"px",height:o-2*c+"px"}),t.css("width",Math.floor(a)+"px")}i=utils.getResizedImageUrl(d,s,h,{siteQuality:n.quality,maxWidth:l.width,maxHeight:l.height}),$(".filler",t).css({backgroundImage:"url("+i+")",backgroundSize:"cover"})},FreestyleController.prototype.changeEditMode=function(){var t=this;"editor"==t.editMode&&t.updateLayout()},FreestyleController.prototype.updateSettings=function(t){var e=this,a=!0;e.mainPageId=t.mainPageId,e.quality=t.quality||{},e.itemsChanged(t.items,["uri"])?a=!0:e.propsChanged(t.props,["cropAndFitStage","imageDecoration","layoutSeed","orientation"])&&(a=!0,e.updated=!1),e.propsChanged(t.props,["applyRotationInLayout"])&&(e.firstLoad=!1),a?(e.destroy(),e.items=t.items||[],e.props=t.props||{},e.createDom()):_.extend(e.props,t.props),e.updateLayout()},FreestyleController.prototype.destroy=function(){this.el.html("")},FreestyleController.prototype._resize=function(){var t=this,e=t.getViewportSize();"horizontal"==t.props.orientation?(t.preservedHeight=e.height,t.el.height(t.preservedHeight)):t.el.height(t.containerHeight),1==!t.updated&&t.updateLayout()},FreestyleController.prototype.getViewportSize=function(){var t=document.documentElement;return{width:t.clientWidth,height:t.clientHeight}},FreestyleController.prototype.zoomClosed=function(){},FreestyleController.prototype.rotate=function(t,e){t.css({"-webkit-transform":"rotate("+e+"deg)","-webkit-transform-origin:":"center center","-moz-transform":"rotate("+e+"deg)","-moz-transform-origin:":"center center","-ms-transform":"rotate("+e+"deg)","-ms-transform-origin:":"center center",transform:"rotate("+e+"deg)","transform-origin:":"center center"})},FreestyleController.prototype.changeCursor=function(t,e){(e+180)%180>22.5&&(e+180)%180<67.5?($(".NW,.SE",t).css("cursor","url(css/Arrow-Vertical-W2.png) 6 14, auto"),$(".SW",t).css("cursor","url(css/Arrow-Horizontal-W2.png) 14 6, auto")):(e+180)%180>67.5&&(e+180)%180<112.5?($(".NW,.SE",t).css("cursor","url(css/Arrow-FLIP_1-W2.png) 11 11, auto"),$(".SW",t).css("cursor","url(css/Arrow-FLIP_2-W2.png) 11 11, auto")):(e+180)%180>112.5&&(e+180)%180<157.5?($(".NW,.SE",t).css("cursor","url(css/Arrow-Horizontal-W2.png) 14 6, auto"),$(".SW",t).css("cursor","url(css/Arrow-Vertical-W2.png) 6 14, auto")):($(".NW,.SE",t).css("cursor","url(css/Arrow-FLIP_2-W2.png) 11 11, auto"),$(".SW",t).css("cursor","url(css/Arrow-FLIP_1-W2.png) 11 11, auto"))},FreestyleController.prototype.changeElCursor=function(t,e){var a=this;"handle SE"==t||"handle NW"==t?(e+180)%180>22.5&&(e+180)%180<67.5?$(a.el).css("cursor","url(css/Arrow-Vertical-W2.png) 6 14, auto"):(e+180)%180>67.5&&(e+180)%180<112.5?$(a.el).css("cursor","url(css/Arrow-FLIP_1-W2.png) 11 11, auto"):(e+180)%180>112.5&&(e+180)%180<157.5?$(a.el).css("cursor","url(css/Arrow-Horizontal-W2.png) 14 6, auto"):$(a.el).css("cursor","url(css/Arrow-FLIP_2-W2.png) 11 11, auto"):"handle SW"==t&&((e+180)%180>22.5&&(e+180)%180<67.5?$(a.el).css("cursor","url(css/Arrow-Horizontal-W2.png) 14 6, auto"):(e+180)%180>67.5&&(e+180)%180<112.5?$(a.el).css("cursor","url(css/Arrow-FLIP_2-W2.png) 11 11, auto"):(e+180)%180>112.5&&(e+180)%180<157.5?$(a.el).css("cursor","url(css/Arrow-Vertical-W2.png) 6 14, auto"):$(a.el).css("cursor","url(css/Arrow-FLIP_1-W2.png) 11 11, auto"))};