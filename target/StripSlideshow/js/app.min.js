var StripGalleryController=function(t,e){var i=this;this.resize=_.debounce(_.bind(this._resize,this),200),StripGalleryController.super_.apply(this,arguments),this.el=t,this.itemClass="item",this.editMode=Wix.Utils.getViewMode(),this.init(e),$(this.el).on("click","."+this.itemClass+" .more",function(t){var e=i.currSlideindex;i.itemClick(i.items[e],e,t.target,t,i.items[e]["data-anchor"],this.mainPageId)})};utils.inherits(StripGalleryController,SimpleAppProto),StripGalleryController.prototype._randomTransition=function(){var t=["crossFade","scroll","slide","zoom"];this._fxRandomized=this._fxRandomized||_.shuffle(t),this._fxRandomIteration=this._fxRandomIteration||0;var e=this._fxRandomIteration%this._fxRandomized.length;return this._fxRandomIteration++,this._fxFromTransition(this._fxRandomized[e])},StripGalleryController.prototype._fxFromTransition=function(t){var e={fx:t,transition:t,speed:1e3*(this.props.transDuration||1)};switch(t){case"none":e.speed=1;break;case"zoom":case"crossFade":e.fx="fadeout";break;case"scroll":e.fx="scrollVert",e.easing="easeInOutQuart";break;case"slide":e.fx="scrollHorz",e.easing="easeInOutQuart";break;case"random":e.fx="random"}return e},StripGalleryController.prototype.dimCrop=function(t,e){var i=Math.max(this.wrapperWidth/t,this.wrapperHeight/e);return i=Math.min(i,1),{height:Math.floor(e*i),width:Math.floor(t*i)}},StripGalleryController.prototype.itemClick=function(t,e,i){this.openLink(t.href,t.target,t.linkType,t[this.mainPageId],t["data-anchor"],this.mainPageId,t.link)},StripGalleryController.prototype.itemTemplate=_.template('<div class="<%=itemClass%>"><div class="inner"><div><div class="img" data-uri="<%=img.uri%>" data-width="<%=img.width%>" data-height="<%=img.height%>"></div><div class="overlay"><div class="sb-description"><% if(description || title) {  %><% if(title) { %><div class="title" title="<%=title%>"><%=title%></div><% } %><% if(description) { %><div class="desc"><%=description%></div><% } %><% } %><div><div class="more">Read more&nbsp;&nbsp;&nbsp;&nbsp;&gt;</div></div></div></div></div>'),StripGalleryController.prototype.init=function(t){this.items=t.items||[],this.props=t.props||{},this.marketingLandingPage=t.marketingLandingPage,this.el.html('<div class="grid-sizer"></div>'),this.gridSizer=$(".grid-sizer"),this.createDom(),this.createLayout(),this._resize()},StripGalleryController.prototype.zoomClosed=function(){this.autoplayResume()},StripGalleryController.prototype.next=function(){$(this.el).cycle("next")},StripGalleryController.prototype.previous=function(){$(this.el).cycle("prev")},StripGalleryController.prototype.autoplayPause=function(){$(this.el).cycle("pause"),this.el.removeClass("image-animation")},StripGalleryController.prototype.autoplayResume=function(){var t=$(this.el);"editor"!=this.editMode&&(this.props.autoplay&&t.cycle("resume"),this.el.addClass("image-animation"))},StripGalleryController.prototype._resize=function(){this.calculateLayoutSizes(),this.updateLayout(),this.moveCaption("in")},StripGalleryController.prototype.destroy=function(){this.el.cycle("destroy")},StripGalleryController.prototype.createDom=function(){var t=this;this.el.html('<div class="grid-sizer"></div><div class="cycle-pager"></div>'),this.calculateLayoutSizes();var e=document.createDocumentFragment();_.each(this.items,function(i,r){e.appendChild(t.createSingleItem(i,r))}),this.el.append(e),(this.marketingLandingPage||this.items.length<=1)&&$(".cycle-pager").hide()},StripGalleryController.prototype.moveCaption=function(t){var e=$(".cycle-slide-active .sb-description"),i=0;switch(t){case"in":i=(this.wrapperHeight-e.height())/2,(void 0==i||i<0||!e.width())&&(i=(this.wrapperHeight-196)/2);break;case"out":i=this.wrapperHeight}e.css("top",i+"px")},StripGalleryController.prototype.createLayout=function(){var t=this;this.itemClass;$(this.el).on("cycle-update-view",function(e,i){t.moveCaption("in")}),$(this.el).on("cycle-after",function(e,i){t.moveCaption("out"),t.currSlideindex!==i.nextSlide&&(t.currSlideindex=i.nextSlide,Wix.pushState(JSON.stringify({cmd:"itemChanged",args:[i.nextSlide]})))}),$(this.el).on("cycle-before",function(e,i,r,s,o){"random"==t.props.transition&&("zoom"==$(s).data("transition")?$(t.el).addClass("animation-zoom"):$(t.el).removeClass("animation-zoom"));var a;if(i.pager){var l=i.nextSlide;a=i.API.getComponent("pager"),a.each(function(){$(this).children().removeClass(i.pagerActiveClass).eq(l).addClass(i.pagerActiveClass)});var n=$(this).width(),h=a.children().eq(l).outerWidth(!0);if(h*a.children().length>n){var d=i.nextSlide>i.currSlide,p=-1*h*l+(d?n/3:2*n/3);p=Math.min(p,n/4),a.css("transform","translateX("+p+"px)")}}}),"editor"==this.editMode&&($(this.el).cycle("pause"),$(this.el).removeClass("image-animation"));var e=t.props.backgroundColor,i=t.props.titleColor;$(this.el).find(".more").hover(function(){$(this).css({color:i,backgroundColor:e})},function(){$(this).css({color:e,backgroundColor:i})})},StripGalleryController.prototype.updateSettings=function(t){var e=!0;if(this.mainPageId=t.mainPageId,this.transitionChanged="editor"==self.editMode&&this.props.transition!=t.props.transition,this.quality=t.quality||{},this.marketingLandingPage=t.marketingLandingPage,(this.props.textMode!=t.props.textMode||this.transitionChanged)&&(e=!0),this.items.length!=t.items.length)e=!0;else for(var i=0;i<this.items.length;i++)if(!_.isEqual(this.items[i],t.items[i])){e=!0;break}this.props=t.props,e?(this.destroy(),this.init(t)):this.resize()},StripGalleryController.prototype.calculateLayoutSizes=function(){this.gridSizer=$(".grid-sizer"),this.wrapperWidth=$("body").width(),this.wrapperHeight=$("body").height(),this.currSlideindex=this.currSlideindex||0,this.gridSizer.width(this.wrapperWidth),$("."+this.itemClass,this.el).width(this.wrapperWidth)},StripGalleryController.prototype.updateLayout=function(){var t=this;this.el.css("text-align",this.props.alignText);var e=utils.pyramid.isOverThresholdChange()||this.preRender,i={height:t.wrapperHeight,width:t.wrapperWidth},r={boxShadow:t.props.boxShadow,"font-family":utils.fontFamilyDegradation(t.props.font)};$("."+this.itemClass,this.el).css(r).css(i).find(".img").css(i),$("."+this.itemClass+":not(.cycle-sentinel)",this.el).each(function(i){if("random"==(t.props.transition||"none")){var r=t._randomTransition();$(this).attr({"data-cycle-fx":r.fx,"data-cycle-speed":r.speed,"data-transition":r.transition})}if(e){var s=$(".overlay",this),o=$(".img",this),a=t.dimCrop(o.data("width"),o.data("height")),l=o.data("uri");o.css({background:"url("+utils.getResizedImageUrl(l,a.width,a.height,{siteQuality:t.quality,maxWidth:o.data("width"),maxHeight:o.data("height")})+")",backgroundRepeat:"no-repeat",backgroundPosition:"50%",backgroundSize:"cover"}),s.height(a.height);s.css("left",Math.max((t.wrapperWidth-980)/2,0))}var n=$(".sb-description",this).css("text-size","10px"),h=$(".desc, .title, .more",this);switch(t.props.alignText){case"right":n.css({left:"auto",right:"20px",float:"right"}),h.css({float:"right",clear:"right"});break;case"center":n.css({left:"auto",right:"auto",float:"none",margin:"0 auto"}),h.css({float:"none",clear:"both"});break;default:case"left":n.css({left:"20px",right:"auto",float:"left"}),h.css({float:"left",clear:"left"})}var d=t.props.backgroundColor,p=t.props.alphaBackgroundColor,c=utils.hexToRgba(d,p),m=t.props.titleColor,u=t.props.alphaTitleColor,g=utils.hexToRgba(m,u),y=t.props.descriptionColor,f=t.props.alphaDescriptionColor,v=utils.hexToRgba(y,f),C=$(".sb-description .title",this),x=$(".sb-description .desc",this),S=$(".sb-description .more",this);C.css({color:g,"background-color":c}),S.css({"background-color":g,color:d,cursor:"pointer"}),void 0==t.items[i]||void 0!=t.items[i].href&&t.items[i].href?S.css({display:"block"}):S.css({display:"none"}),x.css({"background-color":c,color:v});for(var b=document.styleSheets,k=0;k<b.length;k++)try{for(var w=b[k].cssRules||b[k].rules||[],A=0;A<w.length;A++)".cycle-pager span"===w[A].selectorText&&(w[A].style.color=c),".cycle-pager span.cycle-pager-active"===w[A].selectorText&&(w[A].style.color=g)}catch(t){console.log(t)}});var s=t.props.transition||"none",o=t._fxFromTransition(s),a=1e3*t.props.autoplayInterval||5e3,l=!t.props.autoplay||"editor"==t.editMode;switch($(this.el).find(".sb-description").addClass("text-animation"),$(this.el).addClass("image-animation"),$(this.el).removeClass("animation-zoom"),s){case"none":$(this.el).find(".sb-description").removeClass("text-animation");break;case"zoom":$(this.el).addClass("animation-zoom")}$(this.el).cycle({slides:".item",fx:o.fx,speed:o.speed,easing:o.easing,timeout:a,paused:l,startingSlide:t.currSlideindex}),this.transitionChanged&&"editor"==this.editMode&&(_.delay(function(){$(t.el).cycle("next")},1500),this.transitionChanged=!1),this.preRender=!1},StripGalleryController.prototype.createSingleItem=function(t,e){this.preRender=!0;var i=this.itemTemplate,r={itemClass:this.itemClass,img:{src:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",height:t.height,width:t.width,uri:t.uri},title:null,description:null};switch(this.props.textMode){case"titleAndDescription":r.title=t.title,r.description=t.description;break;case"titleOnly":r.title=t.title;break;case"descriptionOnly":r.description=t.description}this.props.galleryImageOnClickAction;var s=i(r);return $(s)[0]},StripGalleryController.prototype.changeEditMode=function(){var t=$(this.el);"editor"==this.editMode?this.autoplayPause():this.autoplayResume(),t.cycle({timeout:1e3*this.props.autoplayInterval})};