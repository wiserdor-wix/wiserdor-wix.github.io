var ThumbnailsController=function(t,i){var e=this;utils.capabilities.mask(),e.resize=_.debounce(_.bind(e._resize,e),200),ThumbnailsController.super_.apply(e,arguments),e.itemClass="item",e.itemSelector="."+e.itemClass,e.isMobile="mobile"==this.deviceType,e.items=[],e.props={},e.dimCache={},e.afterCreate=!1};utils.inherits(ThumbnailsController,SimpleAppProto),ThumbnailsController.prototype.itemClick=function(t,i,e,o){switch(this.props.galleryImageOnClickAction){case"zoomMode":Wix.pushState(JSON.stringify({cmd:"zoom",args:[i]})),this.autoplayPause();break;case"disabled":Wix.pushState(JSON.stringify({cmd:"itemClicked",args:[i]}));break;default:case"goToLink":this.openLink(t.href,t.target,t.linkType,o,t["data-anchor"],this.mainPageId,t.link)}return!1},ThumbnailsController.prototype.init=function(t){this.items=t.items||[],this.props=t.props||{},this.createDom(),this.createLayout(),this._resize()},ThumbnailsController.prototype.zoomClosed=function(){this.autoplayResume()},ThumbnailsController.prototype.next=function(){$("#displayCycle").cycle("next")},ThumbnailsController.prototype.previous=function(){$("#displayCycle").cycle("prev")},ThumbnailsController.prototype._resize=function(){this.updateLayout()},ThumbnailsController.prototype.destroy=function(){$("#displayCycle").cycle("destroy"),this.el.html("")},ThumbnailsController.prototype.getSidesRatio=function(){var t;switch(this.props.componentScale){case"16:9":t=16/9;break;case"4:3":t=4/3;break;case"1:1":default:t=1}return t},ThumbnailsController.prototype.dimCrop=function(t,i){var e=Math.max(this.containerWidth/t,this.containerHeight/i);return{height:Math.floor(i*e),width:Math.floor(t*e)}},ThumbnailsController.prototype.dimFit=function(t,i){var e=Math.min(this.containerWidth/t,this.containerHeight/i);return{height:Math.floor(i*e),width:Math.floor(t*e)}},ThumbnailsController.prototype.calculateLayout=function(){var t,i,e,o,a=this,r=a.props.thumbnailsGravity,s=a.getViewportSize(),n=this.getSidesRatio(),l="top"==r||"bottom"==r,d=l||a.isMobile?50:80,c={position:"absolute",top:0,left:0,right:0,bottom:0},p=$("#display"),h=$("#thumbnailsHolder"),u=$("#thumbnails"),m=$("#displayCycle"),y=$(".thumb",u);switch(l?(i=d,t=a.items.length*Math.floor(d*n+a.props.margin)-a.props.margin,e=s.width,o=s.height-d-8-2,y.css("margin",0).not(":last").css({"margin-right":a.props.margin+"px"}),u.css("margin","1px auto"),i+=2):(t=d,i=a.items.length*Math.floor(d/n+a.props.margin)-a.props.margin,e=s.width-d-8-2,o=s.height,y.css("margin",0).not(":last").css({"margin-bottom":a.props.margin+"px"}),i<s.height&&u.css("margin-top",Math.floor((s.height-i)/2)+"px"),t+=2),u.width(t).height(i),$(".cycle-slide, .filler",m).width(e).height(o),p.add(m).width(e).height(o),a.containerWidth=s.width,a.containerHeight=o,a.props.thumbnailsGravity){case"left":h.css(_.defaults({right:"auto"},c)),p.css(_.defaults({left:"auto"},c));break;case"right":h.css(_.defaults({left:"auto"},c)),p.css(_.defaults({right:"auto"},c));break;case"top":h.css(_.defaults({bottom:"auto"},c)),p.css(_.defaults({top:"auto"},c));break;case"bottom":default:h.css(_.defaults({top:"auto"},c)),p.css(_.defaults({bottom:"auto"},c))}var f=u.closest(".hoverscroll");f.length&&(u.appendTo(h),f.remove()),u.hoverscroll({width:l?"100%":t,height:l?i:"100%",arrows:!1,vertical:!l})},ThumbnailsController.prototype.updateLayout=function(){var t=this;t.calculateLayout();var i=t.getViewportSize();this.el.css(_.extend({overflow:"hidden"},i));var e=$("#display"),o=($("#thumbnailsHolder"),$("#thumbnails"),t.colors());utils.loadGoogleFontIfNeeded(t.props.font),$(".cycle-overlay").css({backgroundColor:o.background,fontFamily:utils.fontFamilyDegradation(t.props.font),textAlign:t.props.alignText}),$(".cycle-overlay .desc").css({color:o.description}),$(".cycle-overlay .title").css({color:o.text}),$(".next,.prev",e).css("background-color",t.props.textBackgroundColor).find(".inner").css("background-color",t.props.textColor);var a=$("#displayCycle"),r=t.afterCreate||utils.pyramid.isOverThresholdChange();$(t.itemSelector,a).each(function(){var i,e,o=$(this).data("item");"fit"==t.props.cropAndFitStage?(i=t.dimFit(o.width,o.height),e="contain"):(i=t.dimCrop(o.width,o.height),e="cover"),$(".filler",this).css({cursor:o.href?"pointer":"auto"}),r&&$(".filler",this).css({backgroundImage:"url("+utils.getResizedImageUrl(o.uri,i.width,i.height,{siteQuality:t.quality,maxWidth:o.width,maxHeight:o.height})+")",backgroundSize:e})})},ThumbnailsController.prototype.autoplayPause=function(){$("#displayCycle").cycle("pause"),this.isPlaying=!1},ThumbnailsController.prototype.autoplayResume=function(){if("editor"!=this.editMode){var t=$("#displayCycle");this.props.autoplay&&t.cycle("resume"),this.isPlaying=this.props.autoplay}},ThumbnailsController.prototype.changeEditMode=function(){var t=$("#displayCycle");"editor"==this.editMode?this.autoplayPause():this.autoplayResume(),t.cycle({timeout:1e3*this.props.autoplayInterval})},ThumbnailsController.prototype._randomTransition=function(){var t=["fade","slide","scroll","zoom"];this._fxRandomized=this._fxRandomized||_.shuffle(t),this._fxRandomIteration=this._fxRandomIteration||0;var i=this._fxRandomIteration%this._fxRandomized.length;return this._fxRandomIteration++,this._fxFromTransition(this._fxRandomized[i])},ThumbnailsController.prototype._fxFromTransition=function(t){var i={fx:t,transition:t,speed:1e3*(this.props.transDuration||1)};switch(t){case"none":i.fxSpeed=i.speed,i.speed=1;break;case"zoom":case"crossFade":i.fx="fadeout";break;case"scroll":i.fx="scrollVert";break;case"slide":i.fx="scrollHorz";break;case"random":i.fx="random";break;case"tile":i.fx="tileBlind";break;case"slice":i.fx="tileSlice"}return i},ThumbnailsController.prototype.createDom=function(){var t=this,i=t.getSidesRatio(),e=t.props.thumbnailsGravity,o="top"==e||"bottom"==e,a=o||t.isMobile?50:80,r=o?a:Math.floor(a/i),s=o?Math.floor(a*i):a,n=t.getViewportSize();t.el.css(_.extend({overflow:"hidden"},n));var l=$("<div></div>").appendTo(t.el).attr("id","display"),d=$("<div></div>").appendTo(t.el).attr("id","thumbnailsHolder"),c=$("<div></div>").appendTo(d).attr("id","thumbnails");if(t.props.arrowMode){$('<div><div class="inner"></div></div>').appendTo(l).addClass("prev"),$('<div><div class="inner"></div></div>').appendTo(l).addClass("next")}var p=$("<div></div>").attr("id","displayCycle").appendTo(l),h=t.props.transition||"none",u=t._fxFromTransition(h);t.initialSlideIndex=t.initialSlideIndex||0,t.initialTransition=t.initialTransition||h;var m,y=o?"inline-block":"block",f="fit"==t.props.cropAndFitStage?"contain":"cover";t.isPlaying=t.props.autoplay&&"editor"!=t.editMode,p.attr({"data-cycle-slides":">div","data-cycle-timeout":1e3*t.props.autoplayInterval,"data-cycle-auto-height":!1,"data-cycle-paused":!t.isPlaying,"data-cycle-fx":u.fx,"data-cycle-log":!1,"data-cycle-speed":u.speed,"data-cycle-pager":"#thumbnails","data-starting-slide":t.initialSlideIndex,"data-cycle-pager-template":"<div class='thumb' style='display:"+y+"; width:{{thumbWidth}}px; height:{{thumbHeight}}px; background: url({{thumb}}) 50% no-repeat; background-size: "+f+";'><div class='overlay'></div></div>","data-cycle-prev":"#display .prev","data-cycle-next":"#display .next"}).on("cycle-before",function(i,e,a,n,l){if(t.initialSlideIndex=$(n).index(),m=$(".overlay",c).removeClass("current").eq(t.initialSlideIndex).addClass("current"),t.isPlaying){var d=t.props.margin,p=t.initialSlideIndex*(s+d)-Math.round((t.containerWidth-s-d)/2);o||(p=t.initialSlideIndex*(r+d)-Math.round((t.containerHeight-r-d)/2));var h={};h[o?"scrollLeft":"scrollTop"]=p,$(c).parent().animate(h,u.fxSpeed||u.speed,function(){})}}).on("cycle-post-initialize",function(i){$(".overlay",c).removeClass("current").eq(t.initialSlideIndex).addClass("current")}).on("cycle-after",function(t,i,e,o){var a=$(o).index();Wix.pushState(JSON.stringify({cmd:"itemChanged",args:[a]}))}),l.on("click",this.itemSelector,function(i){var e=$(i.currentTarget).index();t.itemClick(t.items[e],e,i.target,i)});var g=_.template('<div class="item" data-thumb="<%=thumbnail%>" data-thumb-width="<%=thumbnailWidth%>" data-thumb-height="<%=thumbnailHeight%>"><div class="filler"></div><div class="cycle-overlay"><h3 class="title"><%=title%></h3><div class="desc"><%=description%></div></div></div>');switch(_.each(this.items,function(i){var e;if(_.extend(i,{thumbnail:utils.getResizedImageUrl(i.uri,s,r,{siteQuality:t.quality,maxWidth:i.width,maxHeight:i.height}),thumbnailWidth:s,thumbnailHeight:r}),i.title||(i.title=""),i.description||(i.description=""),e=$(g(i)).appendTo(p).data("item",i),"random"==u.fx){var o=t._randomTransition();e.attr({"data-cycle-fx":o.fx,"data-cycle-speed":o.speed,"data-transition":o.transition})}_.isEmpty(i.title)&&$(".title",e).remove(),_.isEmpty(i.description)&&$(".desc",e).remove(),_.isEmpty(i.title)&&_.isEmpty(i.description)&&$(".cycle-overlay",e).remove()}),t.props.textMode){case"titleAndDescription":break;case"titleOnly":$(".desc",l).remove();break;case"descriptionOnly":$(".title",l).remove();break;case"noText":$(".cycle-overlay",l).remove()}if(p.cycle({}),l.hover(function(){l.addClass("active")},function(){l.removeClass("active")}),c.hover(function(){t.autoplayPause()},function(){t.autoplayResume()}),t.isMobile){l.hammer().on("swipeleft swipeup",function(){p.cycle("next")}).on("swiperight swipedown",function(){p.cycle("prev")});var v=0;c.hammer().on("dragstart",function(t){v=$(".listcontainer").get(0).scrollLeft}).on("drag",function(t){var i=t.gesture;return $(".listcontainer").get(0).scrollLeft=v-i.deltaX,!1}),l.css({touchAction:"auto"})}this.afterCreate=!0},ThumbnailsController.prototype.colors=function(){return{text:utils.hexToRgba(this.props.textColor,this.props.alphaTextColor),description:utils.hexToRgba(this.props.descriptionColor,this.props.alphaDescriptionColor),background:utils.hexToRgba(this.props.textBackgroundColor,this.props.alphaTextBackgroundColor)}},ThumbnailsController.prototype.createLayout=function(){},ThumbnailsController.prototype.updateSettings=function(t){var i=!1;if(this.mainPageId=t.mainPageId,this.quality=t.quality||{},this.el.attr("data-text-mode",t.props.textMode),this.el.attr("data-animation",t.props.transition),this.props=t.props,i=!0,this.props.thumbnailsGravity||(this.props.thumbnailsGravity="bottom"),i?(this.destroy(),this.init(t)):this.resize(),self.initialTransition&&self.initialTransition!=t.props.transition){self.initialTransition=t.props.transition;var e=$("#displayCycle");setTimeout(function(){e.cycle("next")},1e3)}},ThumbnailsController.prototype.getViewportSize=function(){return{width:$(document.body).width(),height:$(document.body).height()}};